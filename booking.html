<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
  <title>จองคิวติดฟิล์ม | YuJin Film Solution</title>
  <meta name="description" content="จองคิวติดตั้งฟิล์มกรองแสงรถยนต์ บริการถึงบ้าน สะดวก รวดเร็ว">
  
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Flatpickr for Date Picker -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/material_blue.css">
  
  <!-- Booking Styles -->
  <link rel="stylesheet" href="booking-styles.css">
</head>
<body>
  <div class="booking-container">
    <!-- Header -->
    <div class="booking-header">
      <button class="back-btn" onclick="window.location.href='index.html'">
        <i class="fas fa-arrow-left"></i>
      </button>
      <h1>จองคิวติดฟิล์ม</h1>
      <p>บริการติดตั้งถึงบ้าน สะดวก รวดเร็ว</p>
    </div>

    <!-- Progress Steps -->
    <div class="progress-steps">
      <div class="step active" data-step="1">
        <div class="step-circle">1</div>
        <div class="step-label">บริการ</div>
      </div>
      <div class="step" data-step="2">
        <div class="step-circle">2</div>
        <div class="step-label">วันเวลา</div>
      </div>
      <div class="step" data-step="3">
        <div class="step-circle">3</div>
        <div class="step-label">ข้อมูล</div>
      </div>
      <div class="step" data-step="4">
        <div class="step-circle">4</div>
        <div class="step-label">ยืนยัน</div>
      </div>
    </div>

    <!-- Form -->
    <form id="bookingForm">
      <!-- Step 1: Service Selection -->
      <div class="form-section active" data-section="1">
        <div class="form-card">
          <h2 class="section-title">
            <i class="fas fa-car"></i>
            เลือกประเภทบริการ
          </h2>
          
          <div class="form-group">
            <label class="form-label">ประเภทบริการ <span class="required">*</span></label>
            <div class="service-options">
              <div class="service-option" data-service="car">
                <div class="service-name">ฟิล์มรถยนต์</div>
                <div class="service-desc">ติดฟิล์มกรองแสงรถยนต์ทุกรุ่น</div>
              </div>
              <div class="service-option" data-service="building">
                <div class="service-name">ฟิล์มบ้าน/อาคาร</div>
                <div class="service-desc">ติดฟิล์มกระจกบ้านและอาคาร</div>
              </div>
            </div>
            <div class="error-message">กรุณาเลือกประเภทบริการ</div>
          </div>

          <div class="form-group" id="carSection" style="display: none;">
            <label class="form-label">ยี่ห้อรถ <span class="required">*</span></label>
            <div class="car-brands">
              <div class="car-brand" data-brand="Toyota">Toyota</div>
              <div class="car-brand" data-brand="Honda">Honda</div>
              <div class="car-brand" data-brand="Mazda">Mazda</div>
              <div class="car-brand" data-brand="Nissan">Nissan</div>
              <div class="car-brand" data-brand="BMW">BMW</div>
              <div class="car-brand" data-brand="Mercedes">Mercedes</div>
              <div class="car-brand" data-brand="Tesla">Tesla</div>
              <div class="car-brand" data-brand="BYD">BYD</div>
              <div class="car-brand" data-brand="MG">MG</div>
              <div class="car-brand" data-brand="GWM">GWM</div>
              <div class="car-brand" data-brand="Neta">Neta</div>
              <div class="car-brand" data-brand="Other">อื่นๆ</div>
            </div>
            
            <!-- Custom brand input for "Other" option -->
            <div class="form-group" id="customBrandSection" style="display: none;">
              <label class="form-label">ระบุยี่ห้อรถ <span class="required">*</span></label>
              <input type="text" class="form-input" id="customBrand" placeholder="กรอกยี่ห้อรถ">
              <div class="error-message">กรุณาระบุยี่ห้อรถ</div>
            </div>
            
            <label class="form-label" style="margin-top: 16px;">รุ่นรถ <span class="required">*</span></label>
            <input type="text" class="form-input" id="carModel" placeholder="เช่น Civic, Camry, Model 3">
            <div class="error-message">กรุณากรอกรุ่นรถ</div>
          </div>

          <div class="form-group">
            <label class="form-label">เบอร์ฟิล์ม <span class="required">*</span></label>
            <div class="service-options">
              <div class="service-option" data-film="40">
                <div class="service-name">40%</div>
                <div class="service-desc">กรองแสง 60% เหมาะกับกระจกด้านหน้า</div>
              </div>
              <div class="service-option" data-film="60">
                <div class="service-name">60%</div>
                <div class="service-desc">กรองแสง 40% ความเข้มปานกลาง</div>
              </div>
              <div class="service-option" data-film="80">
                <div class="service-name">80%</div>
                <div class="service-desc">กรองแสง 20% เข้มเหมาะกับด้านหลัง</div>
              </div>
            </div>
            <div class="error-message">กรุณาเลือกเบอร์ฟิล์ม</div>
          </div>

          <!-- Free Services Section -->
          <div class="form-group">
            <h3 class="free-services-title">
              <i class="fas fa-gift"></i>
              บริการฟรี
            </h3>
            <div class="free-services-list">
              <div class="free-service-item">
                <div class="service-check">✓</div>
                <div class="service-text">ลอกฟิล์มเก่า</div>
              </div>
              <div class="free-service-item">
                <div class="service-check">✓</div>
                <div class="service-text">บริการหลังการขาย</div>
              </div>
              <div class="free-service-item">
                <div class="service-check">✓</div>
                <div class="service-text">รับประกันทุกฟิล์ม ทุกยี่ห้อ</div>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">บริการเสริม</label>
            <div class="addon-list">
              <div class="addon-item" data-addon="insurance" data-price="2500">
                <div class="addon-checkbox"></div>
                <div class="addon-info">
                  <div class="addon-name">ต่อประกันรถยนต์ราคาสุดคุ้ม</div>
                  <div class="addon-price">เริ่มต้น 2,500 บาท</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Step 2: Date & Time -->
      <div class="form-section" data-section="2">
        <div class="form-card">
          <h2 class="section-title">
            <i class="fas fa-calendar"></i>
            เลือกวันและเวลา
          </h2>
          
          <div class="form-group">
            <label class="form-label">เลือกวันที่ <span class="required">*</span></label>
            <div class="calendar-header">
              <div class="month-year" id="currentMonth">มกราคม 2025</div>
              <div class="calendar-nav">
                <button type="button" onclick="changeMonth(-1)">
                  <i class="fas fa-chevron-left"></i>
                </button>
                <button type="button" onclick="changeMonth(1)">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </div>
            </div>
            <div class="calendar-grid" id="calendarGrid">
              <!-- Calendar will be generated here -->
            </div>
            <input type="hidden" id="selectedDate" name="date">
            <div class="error-message">กรุณาเลือกวันที่</div>
          </div>

          <div class="form-group">
            <label class="form-label">เลือกเวลา <span class="required">*</span></label>
            <div class="time-slots">
              <div class="time-slot" data-time="07:00">
                <div class="slot-time">07:00</div>
                <div class="slot-status">ว่าง</div>
              </div>
              <div class="time-slot" data-time="08:00">
                <div class="slot-time">08:00</div>
                <div class="slot-status">ว่าง</div>
              </div>
              <div class="time-slot" data-time="09:00">
                <div class="slot-time">09:00</div>
                <div class="slot-status">ว่าง</div>
              </div>
              <div class="time-slot" data-time="10:00">
                <div class="slot-time">10:00</div>
                <div class="slot-status">ว่าง</div>
              </div>
              <div class="time-slot" data-time="11:00">
                <div class="slot-time">11:00</div>
                <div class="slot-status">ว่าง</div>
              </div>
              <div class="time-slot" data-time="13:00">
                <div class="slot-time">13:00</div>
                <div class="slot-status">ว่าง</div>
              </div>
              <div class="time-slot" data-time="14:00">
                <div class="slot-time">14:00</div>
                <div class="slot-status">ว่าง</div>
              </div>
              <div class="time-slot" data-time="15:00">
                <div class="slot-time">15:00</div>
                <div class="slot-status">ว่าง</div>
              </div>
              <div class="time-slot" data-time="16:00">
                <div class="slot-time">16:00</div>
                <div class="slot-status">ว่าง</div>
              </div>
              <div class="time-slot" data-time="17:00">
                <div class="slot-time">17:00</div>
                <div class="slot-status">ว่าง</div>
              </div>
            </div>
            <input type="hidden" id="selectedTime" name="time">
            <div class="error-message">กรุณาเลือกเวลา</div>
          </div>
        </div>
      </div>

      <!-- Step 3: Customer Information -->
      <div class="form-section" data-section="3">
        <div class="form-card">
          <h2 class="section-title">
            <i class="fas fa-user"></i>
            ข้อมูลการติดต่อ
          </h2>
          
          <div class="form-group">
            <label class="form-label">ชื่อ-นามสกุล <span class="required">*</span></label>
            <input type="text" class="form-input" id="customerName" name="name" placeholder="กรอกชื่อ-นามสกุล">
            <div class="error-message">กรุณากรอกชื่อ-นามสกุล</div>
          </div>

          <div class="form-group">
            <label class="form-label">เบอร์โทรศัพท์ <span class="required">*</span></label>
            <input type="tel" class="form-input" id="customerPhone" name="phone" placeholder="08x-xxx-xxxx" maxlength="10">
            <div class="error-message">กรุณากรอกเบอร์โทรศัพท์ให้ถูกต้อง</div>
          </div>

          <div class="form-group">
            <label class="form-label">อีเมล</label>
            <input type="email" class="form-input" id="customerEmail" name="email" placeholder="your@email.com">
            <div class="error-message">รูปแบบอีเมลไม่ถูกต้อง</div>
          </div>

          <div class="form-group">
            <label class="form-label">Line ID</label>
            <input type="text" class="form-input" id="customerLine" name="line" placeholder="Line ID (ถ้ามี)">
          </div>
        </div>

        <div class="form-card">
          <h2 class="section-title">
            <i class="fas fa-map-marker-alt"></i>
            สถานที่ติดตั้ง
          </h2>
          
          <div class="form-group">
            <label class="form-label">ปักหมุดตำแหน่ง <span class="required">*</span></label>
            <div class="map-container">
              <div class="map-search">
                <input type="text" id="searchAddress" placeholder="ค้นหาสถานที่หรือที่อยู่">
              </div>
              <div id="map"></div>
              <button type="button" class="current-location-btn" onclick="getCurrentLocation()">
                <i class="fas fa-location-crosshairs"></i>
              </button>
            </div>
            <input type="hidden" id="latitude" name="latitude">
            <input type="hidden" id="longitude" name="longitude">
            
            <!-- LatLong Display -->
            <div class="form-group" id="latLongDisplay" style="display: none;">
              <label class="form-label">พิกัด (LatLng)</label>
              <input type="text" class="form-input" id="latLongText" placeholder="ยังไม่ได้ปักหมุด" readonly>
            </div>
            
            <div class="error-message">กรุณาปักหมุดตำแหน่งบนแผนที่</div>
          </div>

          <div class="form-group">
            <label class="form-label">รายละเอียดที่อยู่เพิ่มเติม</label>
            <input type="text" class="form-input" id="addressDetail" name="addressDetail" placeholder="เช่น บ้านเลขที่ ซอย หมู่บ้าน">
          </div>

          <div class="form-group">
            <label class="form-label">หมายเหตุ</label>
            <input type="text" class="form-input" id="customerNote" name="note" placeholder="ข้อมูลเพิ่มเติม (ถ้ามี)">
          </div>
        </div>
      </div>

      <!-- Step 4: Confirmation -->
      <div class="form-section" data-section="4">
        <div class="summary-card">
          <h3 class="summary-title">สรุปการจอง</h3>
          
          <div class="summary-item">
            <span class="summary-label">บริการ:</span>
            <span class="summary-value" id="summaryService">-</span>
          </div>
          
          <div class="summary-item">
            <span class="summary-label">รถ:</span>
            <span class="summary-value" id="summaryCar">-</span>
          </div>
          
          <div class="summary-item">
            <span class="summary-label">เบอร์ฟิล์ม:</span>
            <span class="summary-value" id="summaryFilm">-</span>
          </div>
          
          <div class="summary-item">
            <span class="summary-label">วันที่:</span>
            <span class="summary-value" id="summaryDate">-</span>
          </div>
          
          <div class="summary-item">
            <span class="summary-label">เวลา:</span>
            <span class="summary-value" id="summaryTime">-</span>
          </div>
          
          <div class="summary-item">
            <span class="summary-label">บริการเสริม:</span>
            <span class="summary-value" id="summaryAddons">-</span>
          </div>
          
          <div class="summary-divider"></div>
          
          <div class="summary-total">
            <span>ราคาประมาณการ:</span>
            <span id="summaryTotal">฿5,500</span>
          </div>
        </div>

        <div class="form-card">
          <h2 class="section-title">
            <i class="fas fa-user-check"></i>
            ข้อมูลผู้จอง
          </h2>
          
          <div class="summary-item">
            <span class="summary-label">ชื่อ:</span>
            <span class="summary-value" id="summaryName">-</span>
          </div>
          
          <div class="summary-item">
            <span class="summary-label">โทร:</span>
            <span class="summary-value" id="summaryPhone">-</span>
          </div>
          
          <div class="summary-item">
            <span class="summary-label">สถานที่:</span>
            <span class="summary-value" id="summaryLocation">-</span>
          </div>
        </div>

        <div class="form-card" style="background: #fef3c7; border: 2px solid #fbbf24;">
          <p style="color: #92400e; font-size: 14px; line-height: 1.6;">
            <strong>หมายเหตุ:</strong> ราคาเป็นการประมาณการเบื้องต้น ราคาจริงอาจปรับเปลี่ยนตามขนาดและรุ่นรถ ทางเราจะติดต่อกลับเพื่อยืนยันราคาและนัดหมายอีกครั้ง
          </p>
        </div>
      </div>
    </form>

    <!-- Navigation -->
    <div class="form-navigation">
      <button type="button" class="nav-btn btn-prev" id="prevBtn" style="display: none;">
        <i class="fas fa-arrow-left"></i>
        ย้อนกลับ
      </button>
      <button type="button" class="nav-btn btn-next" id="nextBtn">
        ถัดไป
        <i class="fas fa-arrow-right"></i>
      </button>
    </div>
  </div>

  <!-- Success Modal -->
  <div class="success-modal" id="successModal">
    <div class="success-content">
      <div class="success-icon">
        <i class="fas fa-check"></i>
      </div>
      <h2 class="success-title">จองคิวสำเร็จ!</h2>
      <p class="success-message">
        เราได้รับข้อมูลการจองของคุณเรียบร้อยแล้ว<br>
        ทีมงานจะติดต่อกลับภายใน 15 นาที
      </p>
      
      <div class="success-details">
        <div class="detail-item">
          <span class="detail-label">หมายเลขการจอง:</span>
          <span class="detail-value" id="bookingNumber">BK2025010001</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">วันที่จอง:</span>
          <span class="detail-value" id="bookingDate">-</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">เวลา:</span>
          <span class="detail-value" id="bookingTime">-</span>
        </div>
      </div>
      
      <div class="success-actions">
        <button class="success-btn btn-home" onclick="window.location.href='index.html'">
          กลับหน้าหลัก
        </button>
        <button class="success-btn btn-line" onclick="window.open('https://lin.ee/jxXqHfI', '_blank')">
          แชทผ่าน LINE
        </button>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-spinner"></div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/th.js"></script>
  
  <!-- Google Maps -->
  <script>
    let map;
    let marker;
    let geocoder;
    let autocomplete;
    
    function initMap() {
      console.log('🗺️ Initializing Google Maps...');
      
      // Bangkok center
      const defaultLocation = { lat: 13.7563, lng: 100.5018 };
      
      try {
        map = new google.maps.Map(document.getElementById('map'), {
          center: defaultLocation,
          zoom: 15,
          styles: [
            {
              "featureType": "poi",
              "elementType": "labels",
              "stylers": [{ "visibility": "off" }]
            }
          ],
          mapTypeControl: false,
          fullscreenControl: false,
          streetViewControl: false
        });
        
        console.log('✅ Map initialized successfully');
        
        geocoder = new google.maps.Geocoder();
        
        // Search box
        const searchBox = document.getElementById('searchAddress');
        if (searchBox) {
          autocomplete = new google.maps.places.Autocomplete(searchBox, {
            componentRestrictions: { country: 'th' }
          });
          
          autocomplete.addListener('place_changed', function() {
            const place = autocomplete.getPlace();
            if (place.geometry) {
              map.setCenter(place.geometry.location);
              map.setZoom(17);
              placeMarker(place.geometry.location);
            }
          });
          console.log('✅ Search autocomplete initialized');
        }
        
        // Click to place marker
        map.addListener('click', function(e) {
          console.log('🎯 Map clicked at:', e.latLng.lat(), e.latLng.lng());
          placeMarker(e.latLng);
        });
        
        console.log('✅ Map click listener added');
        
        // Try to get current location
        getCurrentLocation();
        
      } catch (error) {
        console.error('❌ Error initializing map:', error);
      }
    }

    // Add global error handling for Google Maps
    window.gm_authFailure = function() {
      console.error('❌ Google Maps authentication failed');
      alert('ไม่สามารถโหลดแผนที่ได้ กรุณาลองใหม่อีกครั้ง');
    };
    
    function placeMarker(location) {
      console.log('📍 Placing marker at:', location.lat(), location.lng());
      
      try {
        if (marker) {
          marker.setMap(null);
          console.log('🗑️ Removed existing marker');
        }
        
        marker = new google.maps.Marker({
          position: location,
          map: map,
          animation: google.maps.Animation.DROP
        });
        
        console.log('✅ Marker placed successfully');
        
        const lat = location.lat();
        const lng = location.lng();
        
        document.getElementById('latitude').value = lat;
        document.getElementById('longitude').value = lng;
        
        // Show and update LatLong display
        const latLongDisplay = document.getElementById('latLongDisplay');
        const latLongText = document.getElementById('latLongText');
        latLongDisplay.style.display = 'block';
        latLongText.value = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
        
        console.log('✅ LatLng display updated:', latLongText.value);
        
        // Get address from coordinates and populate the editable search field
        geocoder.geocode({ location: location }, function(results, status) {
          if (status === 'OK' && results[0]) {
            document.getElementById('searchAddress').value = results[0].formatted_address;
            console.log('✅ Address updated:', results[0].formatted_address);
          } else {
            console.log('⚠️ Geocoding failed:', status);
          }
        });
        
      } catch (error) {
        console.error('❌ Error placing marker:', error);
      }
    }
    
    function getCurrentLocation() {
      console.log('📍 Attempting to get current location...');
      
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          function(position) {
            console.log('✅ Location obtained:', position.coords.latitude, position.coords.longitude);
            
            const pos = {
              lat: position.coords.latitude,
              lng: position.coords.longitude
            };
            map.setCenter(pos);
            map.setZoom(17);
            placeMarker(new google.maps.LatLng(pos.lat, pos.lng));
          },
          function(error) {
            console.log('⚠️ Location access error:', error.message);
            console.log('ℹ️ Map will use default Bangkok location');
          }
        );
      } else {
        console.log('⚠️ Geolocation not supported');
      }
    }
  </script>
  
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB1buHQFd88w-OtwjU8xUJeMbR7XDPGyy8&libraries=places&callback=initMap"></script>
  
  <script>
    // Form logic
    let currentStep = 1;
    const totalSteps = 4;
    const formData = {
      service: '',
      brand: '',
      model: '',
      film: '',
      addons: [],
      date: '',
      time: '',
      name: '',
      phone: '',
      email: '',
      line: '',
      latitude: '',
      longitude: '',
      address: '',
      addressDetail: '',
      note: ''
    };
    
    // Calendar
    let currentMonth = new Date();
    
    function generateCalendar() {
      const year = currentMonth.getFullYear();
      const month = currentMonth.getMonth();
      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();
      const today = new Date();
      
      const monthNames = ['มกราคม', 'กุมภาพันธ์', 'มีนาคม', 'เมษายน', 'พฤษภาคม', 'มิถุนายน', 
                         'กรกฎาคม', 'สิงหาคม', 'กันยายน', 'ตุลาคม', 'พฤศจิกายน', 'ธันวาคม'];
      const dayNames = ['อา', 'จ', 'อ', 'พ', 'พฤ', 'ศ', 'ส'];
      
      document.getElementById('currentMonth').textContent = `${monthNames[month]} ${year + 543}`;
      
      let html = '';
      
      // Day labels
      dayNames.forEach(day => {
        html += `<div class="day-label">${day}</div>`;
      });
      
      // Empty cells before first day
      for (let i = 0; i < firstDay; i++) {
        html += `<div></div>`;
      }
      
      // Days
      for (let day = 1; day <= daysInMonth; day++) {
        const date = new Date(year, month, day);
        const isToday = date.toDateString() === today.toDateString();
        const isPast = date < today && !isToday;
        const isWeekend = date.getDay() === 0 || date.getDay() === 6;
        
        let classes = 'calendar-day';
        if (isToday) classes += ' today';
        if (isPast) classes += ' disabled';
        if (!isPast && Math.random() > 0.3) classes += ' has-slots';
        
        html += `<div class="${classes}" data-date="${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}" onclick="selectDate(this)">
                  ${day}
                </div>`;
      }
      
      document.getElementById('calendarGrid').innerHTML = html;
    }
    
    function changeMonth(direction) {
      currentMonth.setMonth(currentMonth.getMonth() + direction);
      generateCalendar();
    }
    
    function selectDate(element) {
      if (element.classList.contains('disabled')) return;
      
      document.querySelectorAll('.calendar-day').forEach(day => {
        day.classList.remove('selected');
      });
      
      element.classList.add('selected');
      document.getElementById('selectedDate').value = element.dataset.date;
      formData.date = element.dataset.date;
      
      // Update available time slots (simulation)
      updateTimeSlots();
    }
    
    function updateTimeSlots() {
      const slots = document.querySelectorAll('.time-slot');
      slots.forEach(slot => {
        // Remove disabled status and set all to available for now
        slot.classList.remove('disabled');
        slot.querySelector('.slot-status').textContent = 'ว่าง';
        
        // Note: This function will be connected to backend JS later
        // The disabled CSS classes are preserved for future use
      });
    }
    
    // Service selection
    document.querySelectorAll('.service-option[data-service]').forEach(option => {
      option.addEventListener('click', function() {
        document.querySelectorAll('.service-option[data-service]').forEach(opt => {
          opt.classList.remove('selected');
        });
        this.classList.add('selected');
        formData.service = this.dataset.service;
        
        if (formData.service === 'car') {
          document.getElementById('carSection').style.display = 'block';
        } else {
          document.getElementById('carSection').style.display = 'none';
        }
      });
    });
    
    // Car brand selection
    document.querySelectorAll('.car-brand').forEach(brand => {
      brand.addEventListener('click', function() {
        document.querySelectorAll('.car-brand').forEach(b => {
          b.classList.remove('selected');
        });
        this.classList.add('selected');
        formData.brand = this.dataset.brand;
        
        // Show/hide custom brand input
        const customBrandSection = document.getElementById('customBrandSection');
        if (this.dataset.brand === 'Other') {
          customBrandSection.style.display = 'block';
        } else {
          customBrandSection.style.display = 'none';
          document.getElementById('customBrand').value = '';
        }
      });
    });

    // Custom brand input handler
    document.getElementById('customBrand').addEventListener('input', function() {
      if (formData.brand === 'Other') {
        formData.customBrand = this.value;
      }
    });
    
    // Film selection (multiple, max 2)
    document.querySelectorAll('.service-option[data-film]').forEach(option => {
      option.addEventListener('click', function() {
        const selectedFilms = document.querySelectorAll('.service-option[data-film].selected');
        
        if (this.classList.contains('selected')) {
          // Unselect if already selected
          this.classList.remove('selected');
          formData.film = formData.film.split(',').filter(f => f !== this.dataset.film).join(',');
        } else if (selectedFilms.length < 2) {
          // Select if less than 2 are selected
          this.classList.add('selected');
          if (formData.film) {
            formData.film += ',' + this.dataset.film;
          } else {
            formData.film = this.dataset.film;
          }
        } else {
          // Show message if trying to select more than 2
          alert('สามารถเลือกความเข้มของฟิล์มได้สูงสุด 2 อัน');
        }
      });
    });
    
    // Add-ons selection
    document.querySelectorAll('.addon-item').forEach(addon => {
      addon.addEventListener('click', function() {
        this.classList.toggle('selected');
        const addonData = {
          name: this.dataset.addon,
          price: parseInt(this.dataset.price)
        };
        
        if (this.classList.contains('selected')) {
          formData.addons.push(addonData);
        } else {
          formData.addons = formData.addons.filter(a => a.name !== addonData.name);
        }
        
        updateSummary();
      });
    });
    
    // Time slot selection
    document.querySelectorAll('.time-slot').forEach(slot => {
      slot.addEventListener('click', function() {
        if (this.classList.contains('disabled')) return;
        
        document.querySelectorAll('.time-slot').forEach(s => {
          s.classList.remove('selected');
        });
        this.classList.add('selected');
        document.getElementById('selectedTime').value = this.dataset.time;
        formData.time = this.dataset.time;
      });
    });
    
    // Navigation
    document.getElementById('nextBtn').addEventListener('click', function() {
      if (validateStep(currentStep)) {
        if (currentStep === totalSteps) {
          submitForm();
        } else {
          goToStep(currentStep + 1);
        }
      }
    });
    
    document.getElementById('prevBtn').addEventListener('click', function() {
      goToStep(currentStep - 1);
    });
    
    function goToStep(step) {
      if (step < 1 || step > totalSteps) return;
      
      // Hide current section
      document.querySelector(`.form-section[data-section="${currentStep}"]`).classList.remove('active');
      document.querySelector(`.step[data-step="${currentStep}"]`).classList.remove('active');
      
      // Show new section
      document.querySelector(`.form-section[data-section="${step}"]`).classList.add('active');
      document.querySelector(`.step[data-step="${step}"]`).classList.add('active');
      
      // Mark completed steps
      for (let i = 1; i < step; i++) {
        document.querySelector(`.step[data-step="${i}"]`).classList.add('completed');
      }
      
      currentStep = step;
      
      // Update navigation buttons
      if (currentStep === 1) {
        document.getElementById('prevBtn').style.display = 'none';
      } else {
        document.getElementById('prevBtn').style.display = 'flex';
      }
      
      if (currentStep === totalSteps) {
        document.getElementById('nextBtn').innerHTML = '<i class="fas fa-check"></i> ยืนยันการจอง';
        document.getElementById('nextBtn').classList.add('btn-submit');
        updateSummary();
      } else {
        document.getElementById('nextBtn').innerHTML = 'ถัดไป <i class="fas fa-arrow-right"></i>';
        document.getElementById('nextBtn').classList.remove('btn-submit');
      }
      
      // Scroll to top
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
    
    function validateStep(step) {
      let isValid = true;
      
      if (step === 1) {
        // Validate service selection
        if (!formData.service) {
          document.querySelector('.service-options').parentElement.querySelector('.error-message').classList.add('show');
          isValid = false;
        }
        
        if (formData.service === 'car' && (!formData.brand || !document.getElementById('carModel').value)) {
          if (!formData.brand) {
            document.querySelector('.car-brands').parentElement.querySelector('.error-message').classList.add('show');
          }
          if (!document.getElementById('carModel').value) {
            document.getElementById('carModel').classList.add('error');
            document.getElementById('carModel').parentElement.querySelector('.error-message').classList.add('show');
          }
          isValid = false;
        }
        
        if (!formData.film) {
          document.querySelectorAll('.service-option[data-film]')[0].parentElement.parentElement.querySelector('.error-message').classList.add('show');
          isValid = false;
        }
        
        if (isValid) {
          formData.model = document.getElementById('carModel').value;
        }
      }
      
      if (step === 2) {
        // Validate date and time
        if (!formData.date) {
          document.getElementById('calendarGrid').parentElement.querySelector('.error-message').classList.add('show');
          isValid = false;
        }
        
        if (!formData.time) {
          document.querySelector('.time-slots').parentElement.querySelector('.error-message').classList.add('show');
          isValid = false;
        }
      }
      
      if (step === 3) {
        // Validate customer information
        const name = document.getElementById('customerName').value;
        const phone = document.getElementById('customerPhone').value;
        const email = document.getElementById('customerEmail').value;
        
        if (!name) {
          document.getElementById('customerName').classList.add('error');
          document.getElementById('customerName').parentElement.querySelector('.error-message').classList.add('show');
          isValid = false;
        }
        
        if (!phone || !/^0[0-9]{9}$/.test(phone)) {
          document.getElementById('customerPhone').classList.add('error');
          document.getElementById('customerPhone').parentElement.querySelector('.error-message').classList.add('show');
          isValid = false;
        }
        
        if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
          document.getElementById('customerEmail').classList.add('error');
          document.getElementById('customerEmail').parentElement.querySelector('.error-message').classList.add('show');
          isValid = false;
        }
        
        if (!document.getElementById('latitude').value || !document.getElementById('longitude').value) {
          document.querySelector('.map-container').parentElement.querySelector('.error-message').classList.add('show');
          isValid = false;
        }
        
        if (isValid) {
          formData.name = name;
          formData.phone = phone;
          formData.email = email;
          formData.line = document.getElementById('customerLine').value;
          formData.latitude = document.getElementById('latitude').value;
          formData.longitude = document.getElementById('longitude').value;
          formData.address = document.getElementById('searchAddress').value;
          formData.addressDetail = document.getElementById('addressDetail').value;
          formData.note = document.getElementById('customerNote').value;
        }
      }
      
      if (!isValid) {
        // Shake animation for errors
        document.querySelector('.form-card').classList.add('shake');
        setTimeout(() => {
          document.querySelector('.form-card').classList.remove('shake');
        }, 500);
      }
      
      return isValid;
    }
    
    function updateSummary() {
      // Service
      const serviceText = formData.service === 'car' ? 'ฟิล์มรถยนต์' : 'ฟิล์มบ้าน/อาคาร';
      document.getElementById('summaryService').textContent = serviceText;
      
      // Car
      if (formData.service === 'car') {
        document.getElementById('summaryCar').textContent = `${formData.brand} ${formData.model}`;
      } else {
        document.getElementById('summaryCar').textContent = '-';
      }
      
      // Film
      document.getElementById('summaryFilm').textContent = formData.film ? `${formData.film}%` : '-';
      
      // Date
      if (formData.date) {
        const date = new Date(formData.date);
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('summaryDate').textContent = date.toLocaleDateString('th-TH', options);
      }
      
      // Time
      document.getElementById('summaryTime').textContent = formData.time || '-';
      
      // Add-ons
      if (formData.addons.length > 0) {
        const addonNames = formData.addons.map(a => {
          switch(a.name) {
            case 'remove': return 'ลอกฟิล์มเก่า';
            case 'ceramic': return 'ฟิล์มเซรามิค';
            case 'warranty': return 'ประกัน 10 ปี';
            default: return '';
          }
        });
        document.getElementById('summaryAddons').textContent = addonNames.join(', ');
      } else {
        document.getElementById('summaryAddons').textContent = 'ไม่มี';
      }
      
      // Customer info
      document.getElementById('summaryName').textContent = formData.name || '-';
      document.getElementById('summaryPhone').textContent = formData.phone || '-';
      document.getElementById('summaryLocation').textContent = formData.address || '-';
      
      // Calculate total
      let total = 5500; // Base price
      formData.addons.forEach(addon => {
        total += addon.price;
      });
      document.getElementById('summaryTotal').textContent = `฿${total.toLocaleString()}`;
    }
    
    function submitForm() {
      // Show loading
      document.getElementById('loadingOverlay').classList.add('show');
      
      // Simulate API call
      setTimeout(() => {
        // Generate booking number
        const bookingNumber = 'BK' + new Date().getFullYear() + String(Math.floor(Math.random() * 100000)).padStart(5, '0');
        document.getElementById('bookingNumber').textContent = bookingNumber;
        
        // Set booking details
        const date = new Date(formData.date);
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        document.getElementById('bookingDate').textContent = date.toLocaleDateString('th-TH', options);
        document.getElementById('bookingTime').textContent = formData.time;
        
        // Hide loading
        document.getElementById('loadingOverlay').classList.remove('show');
        
        // Show success modal
        document.getElementById('successModal').classList.add('show');
        
        // Save to localStorage or send to backend
        localStorage.setItem('lastBooking', JSON.stringify({
          ...formData,
          bookingNumber: bookingNumber,
          timestamp: new Date().toISOString()
        }));
        
        // You can send data to your backend here
        // Example: sendToFirebase(formData);
      }, 2000);
    }
    
    // Clear error messages on input
    document.querySelectorAll('.form-input').forEach(input => {
      input.addEventListener('input', function() {
        this.classList.remove('error');
        this.parentElement.querySelector('.error-message').classList.remove('show');
      });
    });
    
    // Initialize calendar on load
    generateCalendar();
    
    // Phone number formatting
    document.getElementById('customerPhone').addEventListener('input', function(e) {
      let value = e.target.value.replace(/\D/g, '');
      if (value.length > 10) {
        value = value.substr(0, 10);
      }
      e.target.value = value;
    });
  </script>
</body>
</html>